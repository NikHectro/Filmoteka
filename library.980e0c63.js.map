{"mappings":"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","sources":["src/library.js"],"sourcesContent":["import ThemeSwitcher from './js/theme-switcher';\nimport StorageListApi from './js/api/storageListApi';\nimport MovieApi from \"./js/api/movieApi\";\nimport makePagination from \"./js/pagination\";\nimport cardsHbs from './templates/cards.hbs';\n\nconst LIBRARY_MODE_KEY = 'library_mode';\nconst WATCHED_PAGE_KEY = 'watched_page';\nconst QUEUE_PAGE_KEY = 'queue_page';\nconst WATCHED = 'watched';\nconst QUEUE = 'queue';\n\nconst ts = new ThemeSwitcher('#slider');\n\ndocument.querySelectorAll(\".modal\").forEach(el => el.style.display = 'none');\n\nconst queueList = new StorageListApi('queue');\nconst watchedList = new StorageListApi('watch');\n\nconst refs = {\n  watchedBtn: document.querySelector('[data-action=\"watched\"]'),\n  queueBtn: document.querySelector('[data-action=\"queue\"]'),\n  cardsUl: document.querySelector(\".gallery__list\"),\n  pagination: document.querySelector(\".gallery__pagination\"),\n}\n\nrefs.watchedBtn.closest('UL').addEventListener('click', evt => {\n  const el = evt.target;\n  const action = el.dataset.action;\n  if (action)\n    updateBtnsState(action);\n});\n\nrefs.cardsUl.addEventListener('click', evt => {\n  evt.preventDefault();\n  const card = evt.target.closest('LI');\n  if (!card)\n    return;\n  if (queueList.inList(card.dataset.id))\n    queueList.removeFromList(card.dataset.id);\n  gotoPage(queueList.page);\n})\n\nrefs.pagination.addEventListener('click', async evt => {\n  if (evt.target.classList.contains('gallery__pag-button--current')) {\n    if (evt.target.dataset.pages === \"1\") return;\n    const formMarkup = `<form style=\"\"><input type=\"number\" name=\"page\" max=\"${evt.target.dataset.pages}\" min=\"1\" value=\"${evt.target.textContent}\" style=\"width:100%; height:100%\"></form>`;\n    evt.target.innerHTML = formMarkup;\n    const form = evt.target.querySelector(\"form\");\n    form.elements.page.focus();\n    form.elements.page.select()\n    form.addEventListener('submit', async e => {\n      e.preventDefault();\n      gotoPage(e.target.elements.page.value);\n      evt.target.textContent = evt.target.dataset.curpage;\n    }, { once: true })\n    form.elements.page.addEventListener('blur', e => {\n      form.remove();\n      evt.target.textContent = evt.target.dataset.curpage;\n    }, { once: true })\n    return;\n  }\n  const page = evt.target.dataset.page;\n  if (page) {\n    gotoPage(page);\n  }\n});\n\nlet gMode = sessionStorage.getItem(LIBRARY_MODE_KEY);\nif (!gMode) gMode = WATCHED;\nupdateBtnsState(gMode);\n\nfunction updateBtnsState(mode) {\n  gMode = mode;\n  sessionStorage.setItem(LIBRARY_MODE_KEY, mode);\n  let page;\n  switch (mode) {\n    case (WATCHED):\n      refs.watchedBtn.classList.add('is-active');\n      refs.queueBtn.classList.remove('is-active');\n      page = sessionStorage.getItem(WATCHED_PAGE_KEY) || 1;\n      break;\n    case (QUEUE):\n      refs.watchedBtn.classList.remove('is-active');\n      refs.queueBtn.classList.add('is-active');\n      page = sessionStorage.getItem(QUEUE_PAGE_KEY) || 1;\n      break;\n    default: return;\n  }\n  gotoPage(page);\n}\n\nfunction renderCards(data) {\n  refs.cardsUl.innerHTML = data\n    ? cardsHbs({ results: data.results, base_path: MovieApi.IMAGES_BASE_URL, showRating: 1 })\n    : `<li class=\"gallery__no-entries\">There are no entries in the ${gMode} list yet</li>`; //makeCardsMarkup(data);\n  refs.pagination.innerHTML = data ? makePagination(data) : '';\n}\n\nfunction gotoPage(page) {\n  let data;\n  switch (gMode) {\n    case WATCHED:\n      data = watchedList.fetchNext(page);\n      if (data)\n        sessionStorage.setItem(WATCHED_PAGE_KEY, data.page);\n      break;\n    case QUEUE:\n      data = queueList.fetchNext(page);\n      if (data)\n        sessionStorage.setItem(QUEUE_PAGE_KEY, data.page);\n      break;\n    default: return;\n  }\n  renderCards(data);\n}"],"names":["$2Z7mb","parcelRequire","$cecbdd76f2d3d4bd$var$LIBRARY_MODE_KEY","$cecbdd76f2d3d4bd$var$WATCHED_PAGE_KEY","$cecbdd76f2d3d4bd$var$QUEUE_PAGE_KEY","$cecbdd76f2d3d4bd$var$WATCHED","$cecbdd76f2d3d4bd$var$QUEUE","default","document","querySelectorAll","forEach","el","style","display","$cecbdd76f2d3d4bd$var$queueList","$hnyov","$cecbdd76f2d3d4bd$var$watchedList","$cecbdd76f2d3d4bd$var$refs","watchedBtn","querySelector","queueBtn","cardsUl","pagination","closest","addEventListener","evt","action","target","dataset","$cecbdd76f2d3d4bd$var$updateBtnsState","preventDefault","card","inList","id","removeFromList","$cecbdd76f2d3d4bd$var$gotoPage","page","async","classList","contains","pages","formMarkup","textContent","innerHTML","form","elements","focus","select","e","value","curpage","once","remove","$cecbdd76f2d3d4bd$var$gMode","sessionStorage","getItem","mode","setItem","add","data","fetchNext","$5cQgp","results","base_path","$cQkN8","IMAGES_BASE_URL","showRating","$jcFG7","$cecbdd76f2d3d4bd$var$renderCards"],"version":3,"file":"library.980e0c63.js.map"}