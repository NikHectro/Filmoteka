{"mappings":"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","sources":["src/library.js"],"sourcesContent":["import './js/scroll-to-top';\nimport ThemeSwitcher from './js/theme-switcher';\nimport StorageListApi from './js/api/storageListApi';\nimport MovieApi from \"./js/api/movieApi\";\nimport makePagination from \"./js/pagination\";\nimport cardsHbs from './templates/cards.hbs';\nimport MovieModal from './js/modals/MovieModal';\nimport TeamModal from './js/modals/TeamModal';\nimport { teamMembers } from \"./js/team-data\";\n\nconst LIBRARY_MODE_KEY = 'library_mode';\nconst WATCHED_PAGE_KEY = 'watched_page';\nconst QUEUE_PAGE_KEY = 'queue_page';\nconst WATCHED = 'watched';\nconst QUEUE = 'queue';\n\nconst ts = new ThemeSwitcher('#slider');\n\nconst queueList = new StorageListApi('queue');\nconst watchedList = new StorageListApi('watched');\n\nconst refs = {\n  watchedBtn: document.querySelector('header [data-action=\"watched\"]'),\n  queueBtn: document.querySelector('header [data-action=\"queue\"]'),\n  cardsUl: document.querySelector(\".gallery__list\"),\n  pagination: document.querySelector(\".gallery__pagination\"),\n  loader: document.querySelector(\".loader\"),\n  teamLink: document.querySelector(\".open-team-modal\"),\n}\n\nrefs.teamLink.addEventListener('click', evt => {\n  evt.preventDefault();\n  const teamModal = new TeamModal(teamMembers);\n  teamModal.show();\n});\n\nrefs.watchedBtn.closest('UL').addEventListener('click', evt => {\n  const el = evt.target;\n  const action = el.dataset.action;\n  if (action)\n    updateBtnsState(action);\n});\n\nlet movieModal;\n\nfunction onMovieModalClose() {\n  if (movieModal)\n    movieModal = null;\n}\n\nfunction updateCurrentList() {\n  let page = gMode === WATCHED\n    ? sessionStorage.getItem(WATCHED_PAGE_KEY) || 1\n    : sessionStorage.getItem(QUEUE_PAGE_KEY) || 1;\n  page = Math.min(page, gMode === WATCHED ? watchedList.getTotalPages() : queueList.getTotalPages());\n  gotoPage(page);\n}\n\nrefs.cardsUl.addEventListener('click', evt => {\n  evt.preventDefault();\n  const card = evt.target.closest('LI');\n  if (!card)\n    return;\n  movieModal = new MovieModal(gMode === 'watched' ? watchedList.getItemById(card.dataset.id) : queueList.getItemById(card.dataset.id), {\n    onClose: onMovieModalClose, onChange: (whatChanged) => {\n      if (whatChanged === gMode)\n        updateCurrentList();\n    }\n  });\n  movieModal.show();\n})\n\nrefs.pagination.addEventListener('click', async evt => {\n  if (evt.target.classList.contains('gallery__pag-button--current')) {\n    if (evt.target.dataset.pages === \"1\") return;\n    const formMarkup = `<form style=\"\"><input type=\"number\" name=\"page\" max=\"${evt.target.dataset.pages}\" min=\"1\" value=\"${evt.target.textContent}\" style=\"width:100%; height:100%\"></form>`;\n    evt.target.innerHTML = formMarkup;\n    const form = evt.target.querySelector(\"form\");\n    form.elements.page.focus();\n    form.elements.page.select()\n    form.addEventListener('submit', async e => {\n      e.preventDefault();\n      gotoPage(e.target.elements.page.value);\n      evt.target.textContent = evt.target.dataset.curpage;\n    }, { once: true })\n    form.elements.page.addEventListener('blur', e => {\n      form.remove();\n      evt.target.textContent = evt.target.dataset.curpage;\n    }, { once: true })\n    return;\n  }\n  const page = evt.target.dataset.page;\n  if (page) {\n    gotoPage(page);\n    window.scrollTo({\n      top: 0,\n      behavior: \"smooth\"\n    });\n  }\n});\n\naddEventListener('storage', (evt) => {\n  if (evt.key === WATCHED || evt.key === QUEUE) {\n    if (movieModal)\n      movieModal.updateButtonsState();\n    updateCurrentList();\n  }\n});\n\nlet gMode = sessionStorage.getItem(LIBRARY_MODE_KEY);\nif (!gMode) gMode = WATCHED;\nupdateBtnsState(gMode);\n\nfunction updateBtnsState(mode) {\n  gMode = mode;\n  sessionStorage.setItem(LIBRARY_MODE_KEY, mode);\n  let page;\n  switch (mode) {\n    case (WATCHED):\n      refs.watchedBtn.classList.add('is-active');\n      refs.queueBtn.classList.remove('is-active');\n      page = sessionStorage.getItem(WATCHED_PAGE_KEY) || 1;\n      break;\n    case (QUEUE):\n      refs.watchedBtn.classList.remove('is-active');\n      refs.queueBtn.classList.add('is-active');\n      page = sessionStorage.getItem(QUEUE_PAGE_KEY) || 1;\n      break;\n    default: return;\n  }\n  gotoPage(page);\n}\n\nfunction renderCards(data) {\n  refs.cardsUl.innerHTML = data\n    ? cardsHbs({ results: data.results.map((el, idx) => ({ ...el, lazy: idx > 2 })), base_path: MovieApi.IMAGES_BASE_URL, showRating: 1 })\n    : `<li class=\"gallery__no-entries\">There are no entries in the ${gMode} list yet</li>`; //makeCardsMarkup(data);\n  refs.pagination.innerHTML = data ? makePagination(data) : '';\n}\n\nasync function gotoPage(page) {\n  let data;\n  refs.loader.classList.remove('is-hidden');\n  switch (gMode) {\n    case WATCHED:\n      data = await watchedList.fetchNext(page);\n      if (data)\n        sessionStorage.setItem(WATCHED_PAGE_KEY, data.page);\n      break;\n    case QUEUE:\n      data = await queueList.fetchNext(page);\n      if (data)\n        sessionStorage.setItem(QUEUE_PAGE_KEY, data.page);\n      break;\n    default: refs.loader.classList.add('is-hidden');\n      return;\n  }\n  renderCards(data);\n  refs.loader.classList.add('is-hidden');\n}\n"],"names":["parcelRequire","$cecbdd76f2d3d4bd$var$LIBRARY_MODE_KEY","$cecbdd76f2d3d4bd$var$WATCHED_PAGE_KEY","$cecbdd76f2d3d4bd$var$QUEUE_PAGE_KEY","$cecbdd76f2d3d4bd$var$WATCHED","$cecbdd76f2d3d4bd$var$QUEUE","$cecbdd76f2d3d4bd$var$queueList","$2Z7mb","default","$hnyov","$cecbdd76f2d3d4bd$var$watchedList","$cecbdd76f2d3d4bd$var$refs","watchedBtn","document","querySelector","queueBtn","cardsUl","pagination","loader","teamLink","$cecbdd76f2d3d4bd$var$movieModal","$cecbdd76f2d3d4bd$var$onMovieModalClose","$cecbdd76f2d3d4bd$var$updateCurrentList","page","$cecbdd76f2d3d4bd$var$gMode","sessionStorage","getItem","Math","min","getTotalPages","$cecbdd76f2d3d4bd$var$gotoPage","addEventListener","evt","preventDefault","$kzlwW","$gHeeA","teamMembers","show","closest","action","target","dataset","$cecbdd76f2d3d4bd$var$updateBtnsState","card","$gcmAn","getItemById","id","onClose","onChange","whatChanged","async","classList","contains","pages","formMarkup","textContent","innerHTML","form","elements","focus","select","e","value","curpage","once","remove","window","scrollTo","top","behavior","key","updateButtonsState","mode","setItem","add","data","fetchNext","$5cQgp","results","map","el","idx","lazy","base_path","$cQkN8","IMAGES_BASE_URL","showRating","$jcFG7","$cecbdd76f2d3d4bd$var$renderCards"],"version":3,"file":"library.e34e7ffd.js.map"}