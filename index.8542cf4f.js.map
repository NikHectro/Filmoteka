{"mappings":"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","sources":["src/index.js"],"sourcesContent":["import './js/scroll-to-top';\nimport throttle from \"lodash.throttle\";\n\nimport ThemeSwitcher from \"./js/theme-switcher\";\nimport MovieApi from \"./js/api/movieApi\";\nimport StorageListApi from \"./js/api/storageListApi\";\nimport makePagination from \"./js/pagination\";\n// import Modal from \"./js/modals/BaseModal\";\n\nimport cardsHbs from './templates/cards.hbs';\n\n// import movieDetailsHbs from './templates/movie-details.hbs';\n// import teamHbs from './templates/team.hbs';\n\nimport { teamMembers } from \"./js/team-data\";\nimport TeamModal from \"./js/modals/TeamModal\";\nimport MovieModal from \"./js/modals/MovieModal\";\n\nconst TRENDING_PAGE_KEY = 'trending_current_page';\nconst SEARCH_PAGE_KEY = 'search_current_page';\nconst SEARCH_QUERY_KEY = 'search_query';\nconst THROTTLE_DELAY = 250;\nconst WATCHED = 'watched';\nconst QUEUE = 'queue';\n\nconst ts = new ThemeSwitcher('#slider');\nconst mApi = new MovieApi();\nconst queueList = new StorageListApi('queue');\n\ndocument.querySelectorAll(\".modal\").forEach(el => el.style.display = 'none');\n\nconst refs = {\n  cardsUl: document.querySelector(\".gallery__list\"),\n  pagination: document.querySelector(\".gallery__pagination\"),\n  header: document.querySelector(\"header\"),\n  footer: document.querySelector(\"footer\"),\n  main: document.querySelector(\"main\"),\n  searchForm: document.querySelector(\".hero-home__form\"),\n  loader: document.querySelector(\".loader\"),\n  homeLinks: document.querySelectorAll(\".js-home\"),\n  teamLink: document.querySelector(\".open-team-modal\"),\n}\n\nconst clearFailMessage = throttle(() => {\n  const ref = document.querySelector(\".search-fail\");\n  if (ref) {\n    ref.remove();\n    refs.searchForm.removeEventListener('input', clearFailMessage);\n  }\n}, THROTTLE_DELAY);\n\nrefs.teamLink.addEventListener('click', evt => {\n  evt.preventDefault();\n  const teamModal = new TeamModal(teamMembers);\n  teamModal.show();\n});\n\nrefs.homeLinks.forEach(el => {\n  el.addEventListener('click', evt => {\n    sessionStorage.removeItem(SEARCH_PAGE_KEY);\n    sessionStorage.removeItem(SEARCH_QUERY_KEY);\n    sessionStorage.removeItem(TRENDING_PAGE_KEY);\n  })\n})\nlet movieModal;\n\nfunction onMovieModalClose() {\n  if (movieModal)\n    movieModal = null;\n}\n\nrefs.cardsUl.addEventListener('click', evt => {\n  evt.preventDefault();\n  const card = evt.target.closest('LI');\n  if (!card)\n    return;\n  movieModal = new MovieModal(mApi.getCachedMovieById(card.dataset.id), { onClose: onMovieModalClose, onChange: null });\n  movieModal.show();\n})\n\nrefs.searchForm.addEventListener('submit', async evt => {\n  evt.preventDefault();\n  const oldFailRef = document.querySelector(\".search-fail\");\n  if (oldFailRef)\n    oldFailRef.remove();\n  const searchQuery = evt.target.elements.searchQuery.value.trim().toLowerCase();\n  if (!searchQuery) return;\n  evt.target.elements.searchQuery.value = searchQuery;\n  // refs.cardsUl.innerHTML = '';\n  refs.loader.classList.remove('is-hidden');\n  let data;\n  try {\n    data = await mApi.fetchNextSearch(searchQuery);\n    sessionStorage.setItem(SEARCH_PAGE_KEY, 1)\n  }\n  catch (e) {\n    console.error(e.message);\n    return;\n  } finally {\n    refs.loader.classList.add('is-hidden');\n  }\n\n  if (!data.results.length) {\n    const failRef = document.createElement('DIV');\n    failRef.textContent = \"Search result not successful. Enter the correct movie name and try again.\";\n    failRef.classList.add('search-fail');\n    evt.target.appendChild(failRef);\n    refs.searchForm.addEventListener('input', clearFailMessage);\n    return;\n  }\n  sessionStorage.setItem(SEARCH_QUERY_KEY, searchQuery);\n  renderCards(data);\n})\n\nrefs.pagination.addEventListener('click', async evt => {\n  if (evt.target.classList.contains('gallery__pag-button--current')) {\n    if (evt.target.dataset.pages === \"1\") return;\n    const formMarkup = `<form style=\"\"><input type=\"number\" name=\"page\" max=\"${evt.target.dataset.pages}\" min=\"1\" value=\"${evt.target.textContent}\" style=\"width:100%; height:100%\"></form>`;\n    evt.target.innerHTML = formMarkup;\n    const form = evt.target.querySelector(\"form\");\n    form.elements.page.focus();\n    form.elements.page.select()\n    form.addEventListener('submit', async e => {\n      e.preventDefault();\n      gotoPage(e.target.elements.page.value);\n      evt.target.textContent = evt.target.dataset.curpage;\n    }, { once: true })\n    form.elements.page.addEventListener('blur', e => {\n      form.remove();\n      evt.target.textContent = evt.target.dataset.curpage;\n    }, { once: true })\n    return;\n  }\n  const page = evt.target.dataset.page;\n  if (page) {\n    gotoPage(page);\n    window.scrollTo({\n      top: 0,\n      behavior: \"smooth\"\n    });\n  }\n});\n\nfunction renderCards(data) {\n  refs.cardsUl.innerHTML = cardsHbs({ results: data.results, base_path: MovieApi.IMAGES_BASE_URL }); //makeCardsMarkup(data);\n  refs.pagination.innerHTML = makePagination(data);\n}\n\nasync function gotoPage(page) {\n  let data;\n  const oldFailRef = document.querySelector(\".search-fail\");\n  if (oldFailRef)\n    oldFailRef.remove();\n  const q = sessionStorage.getItem(SEARCH_QUERY_KEY);\n  if (q) {\n    refs.searchForm.elements.searchQuery.value = q;\n    // refs.cardsUl.innerHTML = '';\n    refs.loader.classList.remove('is-hidden');\n    try {\n      data = await mApi.fetchNextSearch('', page);\n      // console.log(data)\n      sessionStorage.setItem(SEARCH_PAGE_KEY, data.page)\n      renderCards(data);\n    }\n    catch (e) {\n      console.log(e.message)\n    } finally {\n      refs.loader.classList.add('is-hidden');\n    }\n  }\n  else {\n    // refs.cardsUl.innerHTML = '';\n    refs.searchForm.elements.searchQuery.value = '';\n\n    refs.loader.classList.remove('is-hidden');\n    try {\n      data = await mApi.fetchNextTrending(page);\n      sessionStorage.setItem(TRENDING_PAGE_KEY, data.page)\n      // renderTrending(data, await mApi.getCachedGenres());\n      renderCards(data);\n    }\n    catch (e) {\n      console.log(e.message)\n    } finally {\n      refs.loader.classList.add('is-hidden');\n    }\n  }\n}\n\n(async () => {\n  const searchQuery = sessionStorage.getItem(SEARCH_QUERY_KEY);\n  if (searchQuery) {\n    refs.searchForm.elements.searchQuery.value = searchQuery;\n    const searchPage = sessionStorage.getItem(SEARCH_PAGE_KEY);\n    // refs.cardsUl.innerHTML = '';\n    refs.loader.classList.remove('is-hidden');\n    let data;\n    try {\n      // console.log(searchQuery, searchPage)\n      data = await mApi.fetchNextSearch(searchQuery, searchPage || 1);\n    }\n    catch (e) {\n      console.error(e.message)\n    } finally {\n      refs.loader.classList.add('is-hidden');\n    }\n    renderCards(data);\n  }\n  else {\n    const trendingPage = sessionStorage.getItem(TRENDING_PAGE_KEY);\n    // refs.cardsUl.innerHTML = '';\n    refs.loader.classList.remove('is-hidden');\n    let data;\n    try {\n      data = await mApi.fetchNextTrending(trendingPage || 1);\n      // console.log(data)\n    }\n    catch (e) {\n      console.error(e.message)\n    } finally {\n      refs.loader.classList.add('is-hidden');\n    }\n    if (!data.results.length) {\n      refs.cardsUl.innerHTML = '<li>There is no trending movies.</li>';\n      return;\n    }\n    renderCards(data);\n  }\n})();\n\naddEventListener('storage', (evt) => {\n  if (evt.key === WATCHED || evt.key === QUEUE) {\n    if (movieModal)\n      movieModal.updateButtonsState();\n    updateCurrentList();\n  }\n});"],"names":["parcelRequire","$brr8Z","default","$1f0dc3b9307be026$var$mApi","$5gHzC","$9N7Qa","document","querySelectorAll","forEach","el","style","display","$1f0dc3b9307be026$var$refs","cardsUl","querySelector","pagination","header","footer","main","searchForm","loader","homeLinks","teamLink","$1f0dc3b9307be026$var$clearFailMessage","$parcel$interopDefault","$9OeKo","ref","remove","removeEventListener","$1f0dc3b9307be026$var$movieModal","$1f0dc3b9307be026$var$onMovieModalClose","$1f0dc3b9307be026$var$renderCards","data","innerHTML","$44W7Q","results","base_path","IMAGES_BASE_URL","$2nhTy","async","$1f0dc3b9307be026$var$gotoPage","page","oldFailRef","q","sessionStorage","getItem","elements","searchQuery","value","classList","fetchNextSearch","setItem","e","console","log","message","add","fetchNextTrending","e1","addEventListener","evt","preventDefault","$9BQbI","$dLF68","teamMembers","show","removeItem","card","target","closest","$7JPzN","getCachedMovieById","dataset","id","onClose","onChange","trim","toLowerCase","error","length","failRef","createElement","textContent","appendChild","contains","pages","formMarkup","form","focus","select","curpage","once","window","scrollTo","top","behavior","searchPage","trendingPage","data1","key","updateButtonsState","updateCurrentList"],"version":3,"file":"index.8542cf4f.js.map"}