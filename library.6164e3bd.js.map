{"mappings":"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","sources":["src/library.js"],"sourcesContent":["import './js/scroll-to-top';\nimport ThemeSwitcher from './js/theme-switcher';\nimport StorageListApi from './js/api/storageListApi';\nimport MovieApi from \"./js/api/movieApi\";\nimport makePagination from \"./js/pagination\";\nimport cardsHbs from './templates/cards.hbs';\nimport MovieModal from './js/modals/MovieModal';\nimport TeamModal from './js/modals/TeamModal';\nimport { teamMembers } from \"./js/team-data\";\n\nconst LIBRARY_MODE_KEY = 'library_mode';\nconst WATCHED_PAGE_KEY = 'watched_page';\nconst QUEUE_PAGE_KEY = 'queue_page';\nconst WATCHED = 'watched';\nconst QUEUE = 'queue';\n\nconst ts = new ThemeSwitcher('#slider');\n\n// document.querySelectorAll(\".modal\").forEach(el => el.style.display = 'none');\n\nconst queueList = new StorageListApi('queue');\nconst watchedList = new StorageListApi('watched');\n\nconst refs = {\n  watchedBtn: document.querySelector('header [data-action=\"watched\"]'),\n  queueBtn: document.querySelector('header [data-action=\"queue\"]'),\n  cardsUl: document.querySelector(\".gallery__list\"),\n  pagination: document.querySelector(\".gallery__pagination\"),\n  teamLink: document.querySelector(\".open-team-modal\"),\n}\n\nrefs.teamLink.addEventListener('click', evt => {\n  evt.preventDefault();\n  const teamModal = new TeamModal(teamMembers);\n  teamModal.show();\n});\n\nrefs.watchedBtn.closest('UL').addEventListener('click', evt => {\n  const el = evt.target;\n  const action = el.dataset.action;\n  if (action)\n    updateBtnsState(action);\n});\n\nrefs.cardsUl.addEventListener('click', evt => {\n  evt.preventDefault();\n  const card = evt.target.closest('LI');\n  if (!card)\n    return;\n  // if (queueList.inList(card.dataset.id))\n  //   queueList.removeFromList(card.dataset.id);\n  const movieModal = new MovieModal(gMode === 'watched' ? watchedList.getItemById(card.dataset.id) : queueList.getItemById(card.dataset.id), {\n    onClose: null, onChange: (whatChanged) => {\n      // console.dir(queueList)\n      if (whatChanged === gMode) {\n        let page = gMode === WATCHED\n          ? sessionStorage.getItem(WATCHED_PAGE_KEY) || 1\n          : sessionStorage.getItem(QUEUE_PAGE_KEY) || 1;\n        page = Math.min(page, gMode === WATCHED ? watchedList.getTotalPages() : queueList.getTotalPages());\n        gotoPage(page);\n      }\n    }\n  });\n  movieModal.show();\n})\n\nrefs.pagination.addEventListener('click', async evt => {\n  if (evt.target.classList.contains('gallery__pag-button--current')) {\n    if (evt.target.dataset.pages === \"1\") return;\n    const formMarkup = `<form style=\"\"><input type=\"number\" name=\"page\" max=\"${evt.target.dataset.pages}\" min=\"1\" value=\"${evt.target.textContent}\" style=\"width:100%; height:100%\"></form>`;\n    evt.target.innerHTML = formMarkup;\n    const form = evt.target.querySelector(\"form\");\n    form.elements.page.focus();\n    form.elements.page.select()\n    form.addEventListener('submit', async e => {\n      e.preventDefault();\n      gotoPage(e.target.elements.page.value);\n      evt.target.textContent = evt.target.dataset.curpage;\n    }, { once: true })\n    form.elements.page.addEventListener('blur', e => {\n      form.remove();\n      evt.target.textContent = evt.target.dataset.curpage;\n    }, { once: true })\n    return;\n  }\n  const page = evt.target.dataset.page;\n  if (page) {\n    gotoPage(page);\n    window.scrollTo({\n      top: 0,\n      behavior: \"smooth\"\n    });\n  }\n});\n\nlet gMode = sessionStorage.getItem(LIBRARY_MODE_KEY);\nif (!gMode) gMode = WATCHED;\nupdateBtnsState(gMode);\n\nfunction updateBtnsState(mode) {\n  gMode = mode;\n  sessionStorage.setItem(LIBRARY_MODE_KEY, mode);\n  let page;\n  switch (mode) {\n    case (WATCHED):\n      refs.watchedBtn.classList.add('is-active');\n      refs.queueBtn.classList.remove('is-active');\n      page = sessionStorage.getItem(WATCHED_PAGE_KEY) || 1;\n      break;\n    case (QUEUE):\n      refs.watchedBtn.classList.remove('is-active');\n      refs.queueBtn.classList.add('is-active');\n      page = sessionStorage.getItem(QUEUE_PAGE_KEY) || 1;\n      break;\n    default: return;\n  }\n  gotoPage(page);\n}\n\nfunction renderCards(data) {\n  refs.cardsUl.innerHTML = data\n    ? cardsHbs({ results: data.results, base_path: MovieApi.IMAGES_BASE_URL, showRating: 1 })\n    : `<li class=\"gallery__no-entries\">There are no entries in the ${gMode} list yet</li>`; //makeCardsMarkup(data);\n  refs.pagination.innerHTML = data ? makePagination(data) : '';\n}\n\nfunction gotoPage(page) {\n  console.log(page)\n  let data;\n  switch (gMode) {\n    case WATCHED:\n      data = watchedList.fetchNext(page);\n      if (data)\n        sessionStorage.setItem(WATCHED_PAGE_KEY, data.page);\n      break;\n    case QUEUE:\n      data = queueList.fetchNext(page);\n      if (data)\n        sessionStorage.setItem(QUEUE_PAGE_KEY, data.page);\n      break;\n    default: return;\n  }\n  renderCards(data);\n}"],"names":["parcelRequire","$brr8Z","default","$ce3726a01b8ab25a$var$queueList","$9N7Qa","$ce3726a01b8ab25a$var$watchedList","$ce3726a01b8ab25a$var$refs","watchedBtn","document","querySelector","queueBtn","cardsUl","pagination","teamLink","addEventListener","evt","preventDefault","$9BQbI","$dLF68","teamMembers","show","closest","action","target","dataset","$ce3726a01b8ab25a$var$updateBtnsState","card","$7JPzN","$ce3726a01b8ab25a$var$gMode","getItemById","id","onClose","onChange","whatChanged","page","sessionStorage","getItem","Math","min","getTotalPages","$ce3726a01b8ab25a$var$gotoPage","async","classList","contains","pages","formMarkup","textContent","innerHTML","form","elements","focus","select","e","value","curpage","once","remove","window","scrollTo","top","behavior","mode","setItem","add","data","console","log","fetchNext","$44W7Q","results","base_path","$5gHzC","IMAGES_BASE_URL","showRating","$2nhTy","$ce3726a01b8ab25a$var$renderCards"],"version":3,"file":"library.6164e3bd.js.map"}